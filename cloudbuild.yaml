steps:
  - name: 'gcr.io/cloud-builders/docker'
    id: Build
    dir: 'api'
    args: ['build', '-f', 'dockerFile', '-t', 'gcr.io/$PROJECT_ID/api', '.']

  - name: 'gcr.io/cloud-builders/docker'
    id: Push
    args: ['push', 'gcr.io/$PROJECT_ID/api']
    waitFor: ['Build']

  - name: 'docker/compose:1.29.2'
    dir: 'api'
    args: ['up', '-d']
    waitFor: ['Push']

availableSecrets:
  secretManager:
  - versionName: projects/$PROJECT_ID/secrets/db-host/versions/latest
    env: 'DB_HOST'
  - versionName: projects/$PROJECT_ID/secrets/db-username/versions/latest
    env: 'DB_USERNAME'
  - versionName: projects/$PROJECT_ID/secrets/db-password/versions/latest
    env: 'DB_PASSWORD'
  - versionName: projects/$PROJECT_ID/secrets/db-name/versions/latest
    env: 'DB_NAME'
  - versionName: projects/$PROJECT_ID/secrets/JWT_SECRET/versions/latest
    env: 'JWT_SECRET'
  - versionName: projects/$PROJECT_ID/secrets/JWT_EXPIRE_IN/versions/latest
    env: 'JWT_EXPIRE_IN'
  - versionName: projects/$PROJECT_ID/secrets/IS_SIGN/versions/latest
    env: 'IS_SIGN'

logsBucket: 'gs://lottocat_bucket'